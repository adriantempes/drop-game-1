{"version":3,"sources":["assets\\script\\GameManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// import nodeso from \"./nodeso\";\r\n\r\nimport BlockScript from './BlockScript';\r\nimport transition from './transition';\r\nimport transition2 from './transition2';\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nvar SIZE = { x: 130, y: 130 };\r\nvar COL = 5;\r\nvar ROW = 6;\r\nvar BASESIZE = 130;\r\nvar DROPSPEED = 6000;\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class GameManager extends cc.Component {\r\n  public static instance: GameManager;\r\n  @property(cc.Prefab)\r\n  nodeso: cc.Prefab = null;\r\n  Pool1: cc.NodePool = null;\r\n  @property(cc.Node)\r\n \r\n\r\n  \r\n  touchNode: cc.Node = null;\r\n  TouchArea: cc.Node = null;\r\n  \r\n  \r\n  position: cc.Vec3;\r\n  rowCurrent: number = ROW;\r\n  columnCurrent: number = Math.ceil(COL / 2);\r\n  columnTouchNew: number = Math.ceil(COL / 2);\r\n  board: any[];\r\n  needMerge: any[];\r\n  isCanTouch: boolean = true;\r\n  block: any[];\r\n  mergeNumers: any[];\r\n  mergeCount: any[];\r\n  nowNum: any;\r\n  downNumbers: any[];\r\n  downCount: number;\r\n  maxIdxCheck: number = 0;\r\n  continue:boolean;\r\n  keep:boolean;\r\n  \r\n  nextNum: number;\r\n  checkCount: number;\r\n  \r\n  isBlockingToolRow: boolean = false;\r\n  // @property(cc.Node)\r\n  // playBoardArea: cc.Node = null;\r\n  nowPic = null;\r\n  comboCount: number;\r\n \r\n  onLoad() {\r\n    \r\n    cc.game.addPersistRootNode(this.node);\r\n    this.onInitBlock();\r\n    let _this = this;\r\n    GameManager.instance = this;\r\n    this.init();\r\n    this.Pool1 = new cc.NodePool();\r\n    for (let i = 0; i < 4; i++) {\r\n      let enemy = cc.instantiate(this.nodeso);\r\n      this.Pool1.put(enemy);\r\n    }\r\n    let self = this;\r\n\r\n\r\n\r\n\r\n\r\n    this.currenBlock = this.spawn(2, 5);\r\n\r\n    // this.spawn(0, 0);\r\n    console.log(\r\n      \"hehe 1\",\r\n      this.currenBlock.position.x,\r\n      this.currenBlock.position.y\r\n    );\r\n\r\n    this.touchNode.on(cc.Node.EventType.TOUCH_START, (event) => { if (!this.isCanTouch) return;\r\n      let mouse_pos = this.touchNode.convertToNodeSpaceAR(event.getLocation()); //toa do tro chuot\r\n      let board_idx = this.convertPosToIndex(mouse_pos); // chuyen toa do tro chuot qua cot va hang\r\n      let nodeso_pos = this.convert(board_idx.col, 5); //chuyen toa do cot va hang thanh toa do nodeso\r\n      \r\n     \r\n      this.currenBlock.setPosition(nodeso_pos);\r\n    \r\n    }, this);\r\n    this.touchNode.on(cc.Node.EventType.TOUCH_MOVE, (event) => {\r\n      \r\n      // let mouse_pos = event.getLocation();\r\n      // this.currenBlock.setPosition(mouse_pos);\r\n        if (!this.isCanTouch) return;\r\n        let mouse_pos = this.touchNode.convertToNodeSpaceAR(event.getLocation()); //toa do tro chuot\r\n        let board_idx = this.convertPosToIndex(mouse_pos); // chuyen toa do tro chuot qua cot va hang\r\n        let nodeso_pos = this.convert(board_idx.col, 5); //chuyen toa do cot va hang thanh toa do nodeso\r\n        \r\n        // console.log(\r\n        //   \"mouse_pos\",\r\n        //   mouse_pos.x,\r\n        //   mouse_pos.y,\r\n        //   \"mouse moving\",\r\n        //   board_idx.col,\r\n        //   board_idx.line\r\n        // );\r\n        this.currenBlock.setPosition(nodeso_pos);\r\n    }, this);\r\n    this.touchNode.on(cc.Node.EventType.TOUCH_END, (_event) => {\r\n      if (!this.isCanTouch) return;\r\n      var blockscript = _this.block;\r\n      var num = parseInt(_this.currenBlock.getComponent(BlockScript).num.string)\r\n      // blockscript[27] = _this.currenBlock;\r\n      // blockscript[27].num = parseInt(_this.currenBlock.getComponent(BlockScript).num.string)\r\n      // var i : number\r\n      // var j : number\r\n      // var idx = _this.idx(i,j)\r\n      this.isCanTouch = false;\r\n    var B = _this.convertPosToIndex(_this.currenBlock.position) \r\n    var col =  B.col ;\r\n     for (let j = 0; j < 6; j++) {\r\n       \r\n       if (_this.board[col][j] == null) {\r\n        _this.drop(_this.currenBlock, col , j);\r\n        break;\r\n        \r\n       }  \r\n      if(_this.board[col][4] != null && num != blockscript[col + 4*COL].num ){\r\n        this.Load_Scene();\r\n      }\r\n     \r\n      }\r\n      \r\n     \r\n      \r\n  \r\n}, this);\r\n \r\n\r\n  }\r\n  \r\n \r\n\r\nLoad_Scene(){\r\n    cc.director.loadScene(\"endgame\");\r\n}\r\n\r\n\r\n\r\n\r\n \r\n  merge(idx, callback) {\r\n    \r\n    var blockscript = this.block;\r\n    \r\n    \r\n    \r\n    \r\n    \r\n    if (blockscript[idx].num == 0) {\r\n        //Đáng lẽ nó phải được hợp nhất bởi những diem khác.\r\n       \r\n        callback(-100);\r\n        return;\r\n     \r\n    }\r\n    // blockscript[idx].pic = new cc.Node\r\n\r\n    var mergeNumers = this.mergeNumers;\r\n    var mergeDatas = mergeNumers[idx];\r\n    var mergeCount = this.mergeCount;\r\n    // var blockscript = this.block;\r\n   \r\n\r\n \r\n    mergeCount[idx] = mergeDatas.length;\r\n    \r\n    \r\n\r\n    \r\n    var _this = this;\r\n    var mergeNum = blockscript[idx].num * Math.pow(2, mergeDatas.length - 1);\r\n    \r\n    for (var i = 0; i < mergeDatas.length; i++) {\r\n        var subIdx = mergeDatas[i];\r\n        \r\n        var action = null;\r\n        if (subIdx != idx) { //Khối tổng hợp nhấp nháy và biến mất.\r\n          blockscript[subIdx].num = 0;\r\n         (function (subIdx) {\r\n                action = cc.sequence(\r\n                  \r\n                    // cc.fadeTo(0.1, 128),\r\n                    // cc.fadeTo(0.1, 255),\r\n                    cc.moveTo(0.06, _this.getBlockPosition(idx)).easing(cc.easeSineIn()),\r\n                    cc.callFunc(function () {\r\n                    \r\n                        //TODO show anim remove\r\n                       \r\n                    \r\n                        \r\n                        \r\n                        // blockscript[subIdx].pic.getComponent(BlockScript).removeCube();\r\n                \r\n                        \r\n\r\n                        \r\n                        \r\n                        _this.removeCubefromBoard(subIdx)\r\n                        blockscript[subIdx].pic.removeFromParent(true);\r\n                        // blockscript[subIdx].pic.active = false\r\n                        \r\n                        blockscript[subIdx] = {num: 0, pic: null};\r\n                        // blockscript[subIdx] = {num: 0, pic: null};\r\n                        mergeCount[idx] = mergeCount[idx] - 1;\r\n                        // block[subIdx].pic.getComponent(\"cubecomponent\").removeCube();\r\n                        // blockscript[subIdx].pic.getComponent(BlockScript).removeCube();\r\n\r\n\r\n                       \r\n                        if (mergeCount[idx] == 0) {\r\n                            callback(-100);\r\n                        }\r\n                      })\r\n                );\r\n            })(subIdx);\r\n        } else { //Khối tổng hợp sẽ nhấp nháy, sau đó trở thành một khối mới và phóng to lại.\r\n            (function (subIdx) {\r\n                action = cc.sequence(\r\n                  \r\n                    cc.fadeTo(0.05, 128),\r\n                    cc.fadeTo(0.05, 255),\r\n                    cc.callFunc(function () {\r\n                       \r\n                        // blockscript[subIdx].pic.active = false\r\n                        blockscript[subIdx].pic.removeFromParent(true)\r\n                        _this.removeCubefromBoard[subIdx]\r\n                        blockscript[subIdx].num = mergeNum;\r\n                        \r\n                        blockscript[subIdx].pic = _this.createMergeBlock(mergeNum, subIdx );\r\n                        blockscript[subIdx].pic.runAction(cc.sequence(\r\n                            cc.callFunc(function () {\r\n                    \r\n\r\n\r\n                            }),\r\n                            cc.scaleTo(0.03, 2),\r\n                            cc.scaleTo(0.05, 1),\r\n                            cc.callFunc(function () {\r\n                             \r\n                                mergeCount[idx] = mergeCount[idx] - 1;\r\n                               \r\n                                if (mergeCount[idx] == 0) {\r\n                                    callback(mergeNum);\r\n                                }\r\n                            })\r\n                        ));\r\n                    })\r\n                );\r\n                \r\n            })(subIdx);\r\n        }\r\n        \r\n        blockscript[subIdx].pic.runAction(action);\r\n        \r\n       \r\n    }\r\n}\r\nremoveCubeWithIdx(idx) {\r\n  let cube = this.block[idx].pic;\r\n\r\n  if (cube != null) {\r\n      cube.getComponent(BlockScript).removeCube();\r\n  }\r\n  this.block[idx] = {num: 0, pic: null};\r\n}\r\nremoveCubefromBoard(idx){\r\n  // let cube = this.block[idx].pic\r\n  let cube  = this.block[idx].pic;\r\n var position = this.pos(idx);\r\n if(cube != null){\r\n   return this.board[position.x][position.y] = null;\r\n }\r\n this.block[idx] = {num: 0, pic: null};\r\n\r\n  \r\n \r\n }\r\n\r\n\r\n\r\n\r\n\r\n// removeCube(a : cc.Node) {\r\n//   a.active = false;\r\n//   this.Pool1.put(a);\r\n// }\r\ncreateMergeBlock(mergeNum, subIdx) {\r\n  let mergeBlock = this.CreateCube(mergeNum);\r\n  mergeBlock.getComponent(BlockScript).setNum(mergeNum, subIdx);\r\n  // this.movingCube.getComponent(\"CubeComponent\").isTarget = true;\r\n  this.touchNode.addChild(mergeBlock);\r\n\r\n  let pos = this.getBlockPosition(subIdx);\r\n  mergeBlock.setPosition(this.convert(pos.x + 0.01,pos.y - 0.05));\r\n  console.log(\"vi tri la\" + pos);\r\n  \r\n\r\n  return mergeBlock;\r\n}\r\nonInitBlock() {\r\n  \r\n  var blockscript = this.block\r\n  \r\n  if (blockscript != null) {\r\n      for (var i = 0; i < ROW * COL; i++) {\r\n         blockscript[i].num = 0\r\n      }\r\n  } else {\r\n      blockscript = this.block = new Array();\r\n      for (var i = 0; i < ROW * COL; i++) {\r\n          blockscript[i] = {num: 0,pic: null};\r\n\r\n          \r\n      }\r\n      \r\n      \r\n      \r\n  }\r\n}\r\n\r\nsortAfterMerge(){\r\n  var blockscript = this.block;\r\n  var needMerge = this.needMerge;\r\n  if (!this.needMerge) return;\r\n  var downNumbers = this.downNumbers = [];\r\n  for (var col = 0; col < COL; col++) {\r\n    var blank = false;\r\n    //Binh change from row <= Row to Row\r\n    for (var row = 0; row < ROW; row++) {\r\n        var idx = this.idx(col, row);\r\n        //99 is stone\r\n        if (blockscript[idx].num == 0) {\r\n            blank = true;\r\n        \r\n        } else if (blank && blockscript[idx] != 0) {\r\n            //Check if stone not down it\r\n            downNumbers.push(idx);\r\n        }\r\n    }\r\n}\r\nvar addCheckNumbers = [];\r\nfor (var i = 0; i < needMerge.length; i++) {\r\n  var has = false;\r\n  for (var k in downNumbers) {\r\n      if (downNumbers[k] == needMerge[i]) {\r\n          has = true;\r\n          break;\r\n      }\r\n  }\r\n  if (!has) {\r\n      addCheckNumbers.push(needMerge[i]);\r\n  }\r\n}\r\nvar downNumbersCount = downNumbers.length;\r\nif (downNumbersCount == 0) {\r\n    this.checkMerge(needMerge\r\n         )\r\n    return \r\n\r\n}\r\nthis.downCount = downNumbersCount;\r\nvar _this = this;\r\nfor (var i = 0; i < downNumbersCount; i++) {\r\n  let idx = downNumbers[i];\r\n\r\n  let downIdx = idx - COL;\r\n  if (idx > this.maxIdxCheck) {\r\n      this.maxIdxCheck = idx;\r\n  }\r\n  \r\n            while (downIdx - COL > 0) {\r\n                if (blockscript[downIdx - COL].num == 0) {\r\n                    downIdx = downIdx - COL;\r\n                } \r\n                     else {\r\n                        break;\r\n                    \r\n                }\r\n            }\r\n        \r\n           \r\n            blockscript[downIdx].num = blockscript[idx].num;\r\n            blockscript[downIdx].pic = blockscript[idx].pic;\r\n            downNumbers[i] = downIdx\r\n            var downPos = this.pos(downIdx);\r\n            var oldPos = this.pos(idx);\r\n            _this.board[downPos.x][downPos.y] = _this.board[oldPos.x][oldPos.y];\r\n            _this.board[oldPos.x][oldPos.y] = null;\r\n\r\n\r\n            \r\n            blockscript[idx] = {num: 0, pic: null};\r\n            let action = cc.sequence(\r\n                cc.moveBy(0.05, cc.v2(0, -BASESIZE * (idx - downIdx) / COL )).easing(cc.easeIn(3)),\r\n                cc.callFunc(function () {\r\n                        _this.downCount = _this.downCount - 1;\r\n                        if (_this.downCount == 0) {\r\n                            for (let j = 0; j < addCheckNumbers.length; j++) {\r\n                                //TODO // Lỗi nghiêm trọng, được lặp lại. Gxj đã nêu ra.\r\n                                let downHas = false;\r\n                                for (let k = 0; k < downNumbers.length; k++) {\r\n                                    if (downNumbers[k] == addCheckNumbers[j]) {\r\n                                        downHas = true;\r\n                                        break;\r\n                                    }\r\n                                }\r\n                                if (!downHas) {\r\n                                    downNumbers.push(addCheckNumbers[j]);\r\n                                }\r\n                            }\r\n                            _this.checkMerge(downNumbers.reverse());\r\n                            \r\n                            \r\n                            // blockscript[downIdx].pic = _this.board[a.x][a.y];\r\n                            //  _this.board[b.x][b.y] = null;\r\n                           \r\n                        }\r\n                        \r\n                    }\r\n                    \r\n                ));\r\n            \r\n            blockscript[downIdx].pic.runAction(action);\r\n            \r\n        }\r\n  \r\n    }\r\n\r\n\r\n\r\n\r\n\r\n\r\n  CheckAround(mergeIdx, idx) {\r\n    var i : number\r\n   \r\n    var mergeDatas = this.mergeNumers[mergeIdx];\r\n    for (var k in mergeDatas) {\r\n        if (mergeDatas[k] == idx) {\r\n           \r\n            return;\r\n        }\r\n    }\r\n    mergeDatas.push(idx);\r\n        var pos = this.pos(idx);\r\n        var x = pos.x \r\n        var y = pos.y \r\n        // var blockscript = this.currenBlock.getComponent(BlockScript)\r\n        var blockscript = this.block\r\n      //   blockscript[i] = this.currenBlock\r\n      // blockscript[i].num = parseInt(this.currenBlock.getComponent(BlockScript).num.string)\r\n        var num = blockscript[idx].num\r\n        if (x > 0) { //left\r\n            if (blockscript[this.idx(x - 1, y)].num == num) {\r\n                //console.log(\"same left..\")\r\n                this.CheckAround(mergeIdx, this.idx(x - 1, y));\r\n            }\r\n        }\r\n        if (x < COL -1) {  //right\r\n            if (blockscript[this.idx(x + 1, y)].num == num) {\r\n                //console.log(\"same right..\")\r\n                this.CheckAround(mergeIdx, this.idx(x + 1, y));\r\n            }\r\n        }\r\n        if (y < ROW -1) {  //up\r\n            if (blockscript[this.idx(x, y + 1)].num == num) {\r\n                //console.log(\"same up..\")\r\n                this.CheckAround(mergeIdx, this.idx(x, y + 1));\r\n            }\r\n        }\r\n        if (y > 0) {  //down\r\n            if (blockscript[this.idx(x, y - 1)].num == num) {\r\n                //console.log(\"same down..\")\r\n                this.CheckAround(mergeIdx, this.idx(x, y - 1));\r\n            }\r\n        }\r\n        return true\r\n// for (let a = 0; a < around.length; a++) {\r\n//       let _i = i + around[a].i;\r\n//       let _j = j + around[a].j;\r\n//       if(this.board[_i][_j] === null) continue;\r\n//       let nearBlock = this.board[_i][_j].getComponent(BlockScript);\r\n//       if (blockscript.num === nearBlock.num) {\r\n        \r\n//       } else {\r\n\r\n//       }\r\n//     }\r\n  }\r\n \r\n\r\n \r\n \r\n  checkMerge(idxes,keep?){\r\n   \r\n    // this.onInitBlock()\r\n    var a = this.pos(idxes) \r\n    var idx = this.idx(a.x,a.y)\r\n    \r\n\r\n    \r\n    \r\n    // var idx = this.idx(i,j)\r\n    var b = parseInt(this.currenBlock.getComponent(BlockScript).num.string)\r\n    // var num = blockscript[idx].num\r\n    var mergeNumers = this.mergeNumers = [];\r\n    this.mergeCount = []\r\n    var needMerge = this.needMerge = []; //需要合成的点 nhung diem can tong hop\r\n    for (var i = 0; i < idxes.length; i++) {\r\n         idx = idxes[i];\r\n        if (b != 0) {\r\n            mergeNumers[idx] = []; //检查点上的相邻相同数Các số giống hệt nhau liền kề trên các trạm kiểm soát\r\n            this.CheckAround(idx, idx);\r\n            \r\n            if (mergeNumers[idx].length >= 2) {\r\n                needMerge.push(idx);\r\n                keep = true\r\n                //  this.continue = true;\r\n            }\r\n        }\r\n    }\r\n    var needMergeCount = needMerge.length;\r\n    \r\n    this.checkCount = needMergeCount;\r\n    var _this = this;\r\n    for (var i = 0; i < needMergeCount; i++) {\r\n      this.merge(needMerge[i], function (mergeNumber) {\r\n         \r\n          console.log(\"Merge number\" + mergeNumber);\r\n          _this.checkCount = _this.checkCount - 1;\r\n         \r\n          if (_this.checkCount == 0) {\r\n            _this.sortAfterMerge();\r\n              \r\n          }\r\n      })\r\n     \r\n  }\r\n  \r\n }\r\nCreateCube(num){\r\n  let cube = null;\r\n  if(this.Pool1.size()> 0){\r\n    cube = this.Pool1.get(this);\r\n\r\n  } else {\r\n    cube = cc.instantiate(this.nodeso);\r\n  }\r\n  cube.getComponent(BlockScript).setNum(num);\r\n  \r\n  return cube\r\n\r\n   }\r\n\r\n  \r\n\r\n \r\n  \r\n  getMovingIndex() {\r\n    return this.nowPic.getComponent(\"CubeComponent\").getIdx();\r\n  }\r\n  idx(x, y) {\r\n    // var COL = 5\r\n    return (y) * COL + x; //Mang so\r\n  }\r\n  pos(idx) {\r\n    //day la ham cv\r\n    var y = Math.ceil((idx + 1) / COL) - 1;\r\n    var x = idx  - (y) * COL;\r\n    return cc.v2(x, y);\r\n  }\r\n \r\n  getBlockPosition(idx) {\r\n    var pos = this.pos(idx);\r\n    this.convert(pos.x,pos.y)\r\n   \r\n    return cc.v2(pos.x,pos.y)\r\n  }\r\n\r\n\r\n  init() {\r\n    let numofColumns = 5;\r\n    let numofLines = 6;\r\n    this.board = [];\r\n    for (var i = 0; i < numofColumns; i++) {\r\n      let col = [];\r\n      for (var j = 0; j < numofLines; j++) {\r\n        let block = null;\r\n        col.push(block);\r\n     \r\n      }\r\n      this.board.push(col);\r\n    }\r\n    \r\n    console.log(\"initboard\", this.board);\r\n  }\r\n\r\n  convert(col: number, line: number) {\r\n    var _pos = cc.v2( col * SIZE.x + SIZE.x/2  ,line * SIZE.y + SIZE.y/2 + 10 );\r\n    return _pos;\r\n    \r\n  }\r\n\r\n  convertPosToIndex(pos: cc.Vec3) {\r\n    let col: number;\r\n    let line: number;\r\n    pos.z = 0;\r\n    col = Math.floor(pos.x / BASESIZE);\r\n    if(col < 0){\r\n      col = 0\r\n    }\r\n    if(col > 4){\r\n      col = 4\r\n    }\r\n    line = Math.floor(pos.y / BASESIZE)\r\n    if(line < 0){\r\n      line = 0\r\n    }\r\n    if(line > 5){\r\n      line = 5\r\n    }\r\n\r\n    console.log(\"pos =\", col, line, Math.round(pos.x), Math.round(pos.y));\r\n    \r\n\r\n    return { col, line };\r\n  }\r\n\r\n  currenBlock: cc.Node = null;\r\n  B : cc.Node = null;\r\n  spawn(colum: number, line: number) {\r\n  \r\n    // var colum = 2;\r\n    // var line = 5;\r\n    console.log(\"hehe 0\");\r\n    let enemy: cc.Node = null;\r\n    \r\n    if (this.Pool1.size() > 0) {\r\n      enemy = this.Pool1.get();\r\n    } else {\r\n      enemy = cc.instantiate(this.nodeso);\r\n    }\r\n\r\n    enemy.parent = this.touchNode;\r\n   \r\n    enemy.getComponent(BlockScript).setNum(this.getRand(), 27);\r\n    \r\n    \r\n    enemy.setPosition(this.convert(colum, line));\r\n\r\n    \r\n\r\n    return enemy;\r\n  }\r\n  \r\n  \r\n  getRand() {\r\n    let rand = Math.random();\r\n    if (rand < 0.5) {\r\n      return 2;\r\n    } else if ( 0.5 <= rand&&rand < 1 ){\r\n      return 4;\r\n    }\r\n    // else if( 0.4 <= rand&&rand < 0.7 ){\r\n    //   return 8;\r\n    // }\r\n    // else if (0.7 <= rand&&rand < 0.8){\r\n    //   return 16\r\n    // }\r\n    // else if (0.8 <= rand&&rand < 0.9){\r\n    //   return 32\r\n    // }\r\n    // else if (0.9 <= rand&&rand < 0.96){\r\n    //   return 64\r\n    // }\r\n    // else if (0.96 <= rand&&rand < 1){\r\n    //   return 128\r\n    // }\r\n    \r\n  }\r\n  getPoint(mergeNum){\r\n    var Point : number;\r\n    Point = mergeNum\r\n\r\n  }\r\n\r\n\r\n  drop(currentblock: cc.Node, i, j) {\r\n    console.log(\"drop xuong hang\", j);\r\n    let midle_column = 2;\r\n      let highest_line = 5;\r\n    let _this = this;\r\n    var idx =  this.idx(i,j)\r\n    var action = cc.sequence(\r\n      cc.moveTo(0.05,cc.v2(currentblock.position.x, j * 130 + 130/2)),\r\n      cc.callFunc(function(){\r\n        _this.board[i][j] = currentblock;\r\n    \r\n        _this.block[idx].num = parseInt(_this.currenBlock.getComponent(BlockScript).num.string)\r\n        \r\n       _this.block[idx].pic = _this.currenBlock\r\n      \r\n       _this.checkMerge([idx]);\r\n      \r\n\r\n       \r\n       \r\n       _this.currenBlock = _this.spawn(midle_column, highest_line);\r\n       _this.isCanTouch = true\r\n      })\r\n       \r\n    )\r\n    currentblock.runAction(action)\r\n     \r\n    //  cc.tween(currentblock)\r\n    // .to(0.3, {position: new cc.Vec3(currentblock.position.x, j * 130 + 130/2)})\r\n    // .call(function() { \r\n     \r\n    //    _this.board[i][j] = currentblock;\r\n    \r\n    //    _this.block[idx].num = parseInt(currentblock.getComponent(BlockScript).num.string)\r\n       \r\n    //   _this.block[idx].pic = _this.currenBlock\r\n     \r\n    //   _this.checkMerge([idx]);\r\n    //   // _this.currenBlock = _this.spawn(midle_column, highest_line);\r\n     \r\n     \r\n    //   // if(_this.continue = false){\r\n    //   //   _this.currenBlock = _this.spawn(midle_column, highest_line);\r\n    //   // }\r\n    //   // else{\r\n    //   // //  var ngu = cc.sequence(cc.callFunc(function(){\r\n    //   //    _this.checkMerge([idx]);\r\n    //   //   //  _this.spawn(2,5)\r\n          \r\n\r\n    //   //  }\r\n\r\n    //   //  ))\r\n    // // _this.currenBlock.runAction(ngu)\r\n    //   // }\r\n    //  // _this.currenBlock = _this.spawn(midle_column, highest_line);\r\n    //   _this.isCanTouch = true\r\n    \r\n    // })\r\n  \r\n    \r\n   \r\n    // .start()\r\n    \r\n  \r\n    // this.spawn(midle_column, highest_line);\r\n    }\r\n    \r\n  }\r\n  \r\n  \r\n"]}